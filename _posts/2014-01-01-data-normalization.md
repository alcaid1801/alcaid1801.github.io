---
layout: post
title: "对数据进行标准化操作"
categories: 数据分析 
tags: 数学 数据 
---

例子
-----

假定现在有两个班级: 红班和蓝班. 他们是同一个年级具有相同实力的两个班级. 一次考试的时候, 两个班级的成绩呈现一下分布: 

![原始数据][origin]

如果直接看图片, 人们可能会认为红班的人考的比蓝班的好. 一个在蓝班了八十分的人可以认为是考的不错了, 可是在红班也就是一个平均水平. 实际上两个班级的差别主要是由教师出题风格的差异造成的. 红班的出题老师比较宽松, 普遍成绩比较高, 而蓝班的出题老师比较严谨, 学生们的成绩也比较能区分开. 这反映到平均分和标准差如下表格所示: 


>班级 | 均值    | 标准差
>-----|---------|--------------
>红班 | 85.16   | 4.97
>蓝班 | 69.17   | 15.43

为了能够让两个班级的学生能够公平的相互比较, 这里就要对成绩进行变换, 产生一个标准化的成绩用于比较. 

标准化操作
---

> 首先我们需要一个评价的尺度, 假定有一个学生, 这里暂且称之为小X, 他可以自由的选择就读红班和蓝班, 一个公平的评价标准, 就是设计一套标准化操作, 让小X同学认为读红班和蓝班都没有什么区别. 

如果不做任何操作就做比较, 那么小X同学当然会选择红班, 因为红班的老师给分都挺高的. 这时候为了实现公平, 我们对数据进行如下操作

> 把两个班级的成绩减去其各自的平均分, 称为"偏离值". 

如果两个班级的平均实力都相同, 那么评估一个学生的成绩的方法不是看绝对数字的多少, 而是看这个成绩比平均分高了还是低了. 减去平均分之后, 两个班级的新成绩的平均分都为0了.  

![偏离值][average]

这个时候精明的小X同学就果断选蓝班了, 因为在蓝班稍微努力一把就能够拿到比红班最顶尖的人多很多的新成绩(偏离值), 为了让这种投机取巧的行为无路可走, 我们需要对新成绩做进一步操作. 一个简单的想法是考虑一个学生在班级里面的名次, 名次高的分数高. 这种方法的缺点在于, 如果一个班级人数比另一个班级的人数多很多, 那么在人数多的班级里面考高分的难度就比在人数少的班级里面考高分就难很多. 因此我们不能单纯考虑偏离值, 要根据人数变化. 为此我们考虑一个平均偏离值, 是班级每个人的偏差值的绝对值的均值, 这个均值高的班级, 可以认为出题能够区分难度, 因为普遍偏离班级平均分的数值都很大, 而这个偏离值的影响的方法就是把每个同学的偏离值除以这个均值. 这样就得到以下步骤:

> 把两个班级的偏离值除以各自的平均偏离值, 称为"偏差值". 

一般来说, 在实际的做法中平均偏差值是偏离值的平方和再开根号, 也就是我们常见的"标准差". 把偏离值除以各自的标准差之后, 两个班级的标准差就都为1了. 此时红蓝班的分布就十分相似. 

![偏差值][std]

前提条件
---
实际上, 在以前很长的一段时间, 许多省份(例如广东)在高考的时候采用的标准分算法, 其具体做法和上面的的步骤是一样的, 只不过为了不要让同学们最后的成绩太难看(妈妈我考了3分-_-), 最终成绩又把数据变换为平均分为500分, 标准差100分. 其目的是为了让两个不同的科目具有可比性, 例如同为理科的物理和化学. 而这个标准化方法能够实现公平, 是有前提的. 根据我上面的说法, 两份数据能够实现标准化从而相互比较, 必须满足:

* 两份数据的平均水准是一样的
* 两份数据的平均偏离程度也是一样的

在数据标准化操作的第一步, 我说了"评估一个学生的成绩的方法不是看绝对数字的多少, 而是看这个成绩比平均分高了还是低了". 这里隐含的意思, 就是两个班级的平均值(也就是平均实力)是一样的. 如果本来一个班级就是重点班, 而另一个不是, 那么就应该对两个班级区分对待. 现代的智商测试之所以需要考虑年龄因素, 就是因为不同年龄段的人的知识水平不一样. 

而在标准化过程第二步里面, 如果本来蓝班就是一群成绩非常好的人和一群非常差的人, 而红班全班确实比较平庸, 那么继续标准化就显得没有意义. 因此第二步实际上隐含了另一个前提, 就是两个班级具有相同的平均偏离程度. 

实际上, 最后标准化得到的结果, 代表着一个学生这个班级的相对名次. 而上面两个假设, 让这个相对名次与知识程度能够挂钩, 也就是考察汗水+天赋. 如果考虑一个班级的平均分服从正态分布, 对于偏差值分别在±1,±2,±3之间的学生, 其原始分数实际上就是处在班级原始分的±1,±2,±3个标准差之间, 而落入正态分布±1/2/3个标准差之间的可能性分别是68%,95%,99%. 通过这样的方法, 我们可以这么说: 如果你的偏差值大于1, 那说明你是人群中那32%, 如果你的偏差值大于2, 同理我们可以认为你是人群中的那5%. 而按道理服从正态分布的数据有99%的部分都是在±3个标准差以内, 那么偏差值为3的学生就是人群中的1%了, 当然这里的1%有傲立顶端的部分, 也有深居底层的悲剧. 

结束
---
实际上, 上面的部分隐含了最后一个条件, 那就是一个班级的成绩的分布必须要服从正态分布. 这在大规模的考试(例如高考)中是成立的. 而根据大数定律和[中心极限定理][Central_limit_theorem], 我们可以发现生活中很多的数据其实都是服从正态分布的. 那么在一般的数据分析和数据挖掘的预处理过程中, 如果需要把不同来源的数据进行比较和计算, 那么最简单的方法就是通过以上步骤进行数据标准化. 

另外, 分数标准化并不是这么容易的, 例如原来考100分的人才, 按道理满分应该都意味着"本评价体系无法继续测量其水准", 标准化之后不同班级的100分却可能不一致了, 导致新的的不公平. 例如下图我把原始数据映射为高考的标准分. 可以看到蓝班最高分到700分就结束了. 这是因为我在随机生成蓝班数据的时候, 把超过100分的数据强制转换为100分, 而这个峰值在不断的转换过程中被可怜的转化为700分. 从而导致了悲剧的发生. 

![标准分][re_norm]


代码资源: 
为了写这篇博客, 我随机生成了两个不同班级的学生, 并画出每一个步骤的相应分布. 资源在[此处][code]. 


[origin]: /figure/2014-01-01-data-normalization/origin.png "原始数据"
[average]: /figure/2014-01-01-data-normalization/average.png "减去各自的平均分"
[std]: /figure/2014-01-01-data-normalization/std.png "除以标准差"
[re_norm]: /figure/2014-01-01-data-normalization/re_norm.png "标准分"


[code]: /assets/2014-01-01-data-normalization/code.py
[Central_limit_theorem]: http://zh.wikipedia.org/wiki/%E4%B8%AD%E5%BF%83%E6%9E%81%E9%99%90%E5%AE%9A%E7%90%86 "中心极限定理"

